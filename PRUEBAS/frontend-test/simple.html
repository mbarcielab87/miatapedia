<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miatapedia - Frontend Limpio</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; text-align: center; }
        .status.loading { background: #e7f3ff; color: #0066cc; }
        .status.error { background: #ffe7e7; color: #cc0000; }
        .status.success { background: #e7ffe7; color: #006600; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #C41E3A; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        .debug { background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        button { background: #C41E3A; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #a01729; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 15px 0; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; border-left: 4px solid #C41E3A; }
        .stat-number { font-size: 2em; font-weight: bold; color: #C41E3A; }
        .stat-label { color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— Miatapedia - Frontend Limpio</h1>

        <div class="debug">
            <h3>ğŸ”§ Estado de ConexiÃ³n</h3>
            <div id="connection-status" class="status loading">Verificando...</div>
            <button onclick="testConnection()">ğŸ”„ Probar ConexiÃ³n</button>
            <button onclick="loadAllData()">ğŸ“Š Cargar Todos los Datos</button>
        </div>

        <div class="debug">
            <h3>ğŸ“‹ Log de Consola</h3>
            <pre id="console-log" style="height: 200px; overflow-y: auto;"></pre>
            <button onclick="clearLog()">ğŸ—‘ï¸ Limpiar Log</button>
        </div>

        <div class="section">
            <h2>ğŸ“Š EstadÃ­sticas</h2>
            <div id="stats-container" class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="stat-foros">-</div>
                    <div class="stat-label">Foros</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-proveedores">-</div>
                    <div class="stat-label">Proveedores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-manuales">-</div>
                    <div class="stat-label">Manuales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-eventos">-</div>
                    <div class="stat-label">Eventos</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’¬ Foros</h2>
            <div id="foros-status" class="status loading">No cargados</div>
            <button onclick="loadForos()">ğŸ“¥ Cargar Foros</button>
            <table id="foros-table" style="display:none;">
                <thead>
                    <tr><th>Nombre</th><th>PaÃ­s</th><th>DescripciÃ³n</th><th>URL</th></tr>
                </thead>
                <tbody id="foros-body"></tbody>
            </table>
        </div>

        <div class="section">
            <h2>ğŸ›’ Proveedores</h2>
            <div id="proveedores-status" class="status loading">No cargados</div>
            <button onclick="loadProveedores()">ğŸ“¥ Cargar Proveedores</button>
            <table id="proveedores-table" style="display:none;">
                <thead>
                    <tr><th>Nombre</th><th>PaÃ­s</th><th>Tipo</th><th>GeneraciÃ³n</th><th>URL</th></tr>
                </thead>
                <tbody id="proveedores-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        // ConfiguraciÃ³n de la API
        const API_BASE = 'http://172.22.133.26:3000/api';

        // Sistema de logging personalizado
        const logElement = document.getElementById('console-log');
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.log(logMessage);
            logElement.textContent += logMessage + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            logElement.textContent = '';
            log('ğŸ—‘ï¸ Log limpiado');
        }

        function updateStatus(elementId, message, type = 'loading') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        // FunciÃ³n fetch simplificada
        async function apiCall(endpoint) {
            const url = `${API_BASE}${endpoint}`;
            log(`ğŸ“¡ Llamando a: ${url}`);

            try {
                const response = await fetch(url);
                log(`ğŸ“¨ Respuesta: ${response.status} ${response.statusText}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                log(`ğŸ“¦ Datos recibidos: ${JSON.stringify(data).substring(0, 100)}...`);
                return data;
            } catch (error) {
                log(`âŒ Error: ${error.message}`);
                throw error;
            }
        }

        // Probar conexiÃ³n
        async function testConnection() {
            log('ğŸ” Probando conexiÃ³n con la API...');
            updateStatus('connection-status', 'Probando conexiÃ³n...', 'loading');

            try {
                const result = await apiCall('/test');
                updateStatus('connection-status', 'âœ… Conectado correctamente', 'success');
                log('âœ… ConexiÃ³n exitosa');
                return true;
            } catch (error) {
                updateStatus('connection-status', `âŒ Error: ${error.message}`, 'error');
                log(`âŒ Error de conexiÃ³n: ${error.message}`);
                return false;
            }
        }

        // Cargar estadÃ­sticas
        async function loadStats() {
            log('ğŸ“Š Cargando estadÃ­sticas...');
            try {
                const stats = await apiCall('/stats');
                document.getElementById('stat-foros').textContent = stats.foros;
                document.getElementById('stat-proveedores').textContent = stats.proveedores;
                document.getElementById('stat-manuales').textContent = stats.manuales;
                document.getElementById('stat-eventos').textContent = stats.eventos;
                log('âœ… EstadÃ­sticas cargadas');
            } catch (error) {
                log(`âŒ Error cargando estadÃ­sticas: ${error.message}`);
            }
        }

        // Cargar foros
        async function loadForos() {
            log('ğŸ’¬ Cargando foros...');
            updateStatus('foros-status', 'Cargando foros...', 'loading');

            try {
                const foros = await apiCall('/foros');
                const tbody = document.getElementById('foros-body');

                tbody.innerHTML = foros.map(foro => `
                    <tr>
                        <td>${foro.nombre}</td>
                        <td>${foro.pais}</td>
                        <td>${foro.descripcion || '-'}</td>
                        <td><a href="${foro.url}" target="_blank">Visitar</a></td>
                    </tr>
                `).join('');

                document.getElementById('foros-table').style.display = 'table';
                updateStatus('foros-status', `âœ… ${foros.length} foros cargados`, 'success');
                log(`âœ… ${foros.length} foros cargados`);
            } catch (error) {
                updateStatus('foros-status', `âŒ Error: ${error.message}`, 'error');
                log(`âŒ Error cargando foros: ${error.message}`);
            }
        }

        // Cargar proveedores
        async function loadProveedores() {
            log('ğŸ›’ Cargando proveedores...');
            updateStatus('proveedores-status', 'Cargando proveedores...', 'loading');

            try {
                const proveedores = await apiCall('/proveedores');
                const tbody = document.getElementById('proveedores-body');

                tbody.innerHTML = proveedores.map(proveedor => `
                    <tr>
                        <td>${proveedor.nombre}</td>
                        <td>${proveedor.pais}</td>
                        <td>${proveedor.tipo}</td>
                        <td>${proveedor.generacion}</td>
                        <td><a href="${proveedor.url}" target="_blank">Visitar</a></td>
                    </tr>
                `).join('');

                document.getElementById('proveedores-table').style.display = 'table';
                updateStatus('proveedores-status', `âœ… ${proveedores.length} proveedores cargados`, 'success');
                log(`âœ… ${proveedores.length} proveedores cargados`);
            } catch (error) {
                updateStatus('proveedores-status', `âŒ Error: ${error.message}`, 'error');
                log(`âŒ Error cargando proveedores: ${error.message}`);
            }
        }

        // Cargar todos los datos
        async function loadAllData() {
            log('ğŸš€ Cargando todos los datos...');
            await loadStats();
            await loadForos();
            await loadProveedores();
            log('ğŸ Carga completa');
        }

        // InicializaciÃ³n
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ PÃ¡gina cargada');
            log('ğŸ”— API configurada en: ' + API_BASE);

            // Probar conexiÃ³n automÃ¡ticamente
            setTimeout(testConnection, 500);
        });

        log('ğŸ“„ Script inicializado');
    </script>
</body>
</html>